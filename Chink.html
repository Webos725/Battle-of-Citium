<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ’© Poopã‚¯ãƒªãƒƒã‚«ãƒ¼ ğŸ’©</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f9e7c7;
      color: #3e2f1c;
      text-align: center;
      transition: background 0.5s;
    }
    #poopImage {
      width: 220px;
      cursor: pointer;
      margin: 20px auto;
      border-radius: 50%;
      box-shadow: 0 0 20px rgba(80,60,30,0.3);
      display: block;
    }
    .section {
      max-width: 600px;
      margin: 20px auto;
      text-align: left;
    }
    .shop-item, .upgrade-item, .click-upgrade-item {
      margin: 10px 0;
      padding: 10px;
      background: #fffbe0;
      border: 1px solid #99845f;
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .shop-item img, .upgrade-item img, .click-upgrade-item img {
      width: 60px;
      height: 60px;
      border-radius: 8px;
      object-fit: cover;
      box-shadow: 0 0 8px rgba(0,0,0,0.2);
    }
    button {
      margin-left: auto;
      padding: 6px 12px;
      cursor: pointer;
      border: none;
      background-color: #99845f;
      color: white;
      border-radius: 4px;
      transition: background-color 0.3s;
    }
    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    button:hover:not(:disabled) {
      background-color: #7a6a42;
    }
    .fever {
      animation: feverFlash 0.5s infinite alternate;
    }
    @keyframes feverFlash {
      from { background-color: #ffcc00; }
      to { background-color: #ffe066; }
    }
    #rebirthInfo {
      margin-top: 20px;
      background: #fffbe0;
      border: 1px solid #99845f;
      border-radius: 8px;
      padding: 10px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <h1>ğŸ’© Poopã‚¯ãƒªãƒƒã‚«ãƒ¼ ğŸ’©</h1>
  <p>Poop: <span id="poop">0</span></p>
  <img id="poopImage" src="export1750063812443.png" alt="Poop" />
  <p><button onclick="resetGame()">ğŸ” ãƒªã‚»ãƒƒãƒˆ</button></p>

  <div class="section">
    <h2>æ–½è¨­ã‚·ãƒ§ãƒƒãƒ—</h2>
    <div id="shop"></div>
  </div>

  <div class="section">
    <h2>ãƒŸãƒ«ã‚¯ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰</h2>
    <div id="upgrades"></div>
  </div>

  <div class="section">
    <h2>ã‚¯ãƒªãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰</h2>
    <div id="clickUpgrades"></div>
  </div>

  <div class="section">
    <h2>è»¢ç”Ÿãƒœãƒ¼ãƒŠã‚¹</h2>
    <div id="rebirthSection">
      <p>è»¢ç”Ÿå›æ•°: <span id="rebirthCount">0</span></p>
      <p>è»¢ç”Ÿãƒœãƒ¼ãƒŠã‚¹: <span id="rebirthBonus">x1</span></p>
      <button id="rebirthBtn" onclick="rebirth()" style="padding:10px 20px; font-size:16px;">ğŸ”„ è»¢ç”Ÿã™ã‚‹ï¼ˆç¾åœ¨ã®PoopãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ï¼‰</button>
      <p id="rebirthInfo">è»¢ç”Ÿã™ã‚‹ã“ã¨ã§ã€ç”Ÿç”£åŠ¹ç‡ã¨ã‚¯ãƒªãƒƒã‚¯åŠ›ã«ãƒœãƒ¼ãƒŠã‚¹ãŒæ°¸ä¹…ã«åŠ ç®—ã•ã‚Œã¾ã™ã€‚ãƒœãƒ¼ãƒŠã‚¹ã¯è»¢ç”Ÿå›æ•°ã«å¿œã˜ã¦å¢—åŠ ã—ã¾ã™ã€‚</p>
    </div>
  </div>

  <audio id="clickSE" src="https://cdn.pixabay.com/audio/2022/03/15/audio_676d8b6c4f.mp3" preload="auto"></audio>
  <audio id="feverSE" src="https://cdn.pixabay.com/audio/2022/03/04/audio_9cf69cc69e.mp3" preload="auto"></audio>

  <script>
    // ã‚²ãƒ¼ãƒ ã®åŸºæœ¬ã‚¹ãƒ†ãƒ¼ãƒˆ
    let poop = 0;
    let clickPower = 1;
    let milkLevel = 0;
    let clickUpgradeLevel = 0;
    let feverMode = false;
    let feverTimeout;
    let rebirthCount = 0;   // è»¢ç”Ÿå›æ•°
    let rebirthMultiplier = 1;  // è»¢ç”Ÿãƒœãƒ¼ãƒŠã‚¹å€ç‡

    // å¤§ãã„æ•°å­—ç”¨å˜ä½é…åˆ—ï¼ˆç„¡é™ã«æ‹¡å¼µå¯ï¼‰
    const units = [
      "", "K", "M", "B", "T",
      "Qa", "Qi", "Sx", "Sp", "Oc",
      "No", "Dc", "Ud", "Dd", "Td",
      "Qa2", "Qi2", "Sx2", "Sp2", "Oc2",
      "No2", "Vg", "Uv", "Dv", "Tv",
    ];

    // ãƒŸãƒ«ã‚¯ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿
    const milkData = [
      { name: "ãªã—", multiplier: 1, cost: 0, color: "#f9e7c7", image: "export1750063812443.png" },
      { name: "ä½è„‚è‚ªãƒŸãƒ«ã‚¯", multiplier: 1.5, cost: 1000, color: "#e1f0e5", image: "export1750063812443.png" },
      { name: "æ™®é€šãƒŸãƒ«ã‚¯", multiplier: 3, cost: 7000000, color: "#d9f1ff", image: "export1750063812443.png" },
      { name: "æ¿ƒåšãƒŸãƒ«ã‚¯", multiplier: 6, cost: 140000000000000, color: "#fff5d6", image: "export1750063812443.png" },
      { name: "é‡‘ã®ãƒŸãƒ«ã‚¯", multiplier: 10, cost: 136000000000000000, color: "#fff8b2", image: "export1750063812443.png" },
      { name: "ãƒãƒ§ã‚³ãƒŸãƒ«ã‚¯", multiplier: 17, cost: 79200000000000000000, color: "#aa3300", image: "export1750063812443.png" },
      { name: "ã‚¤ãƒã‚´ã‚ªãƒ¬", multiplier: 30, cost: 96000000000000000000000000, color: "#ff66ff", image: "export1750063812443.png" },
      { name: "ãƒ¡ãƒ­ãƒ³ãƒŸãƒ«ã‚¯", multiplier: 36, cost: 36000000000000000000000000, color: "#66ff66", image: "export1750063812443.png" },
      { name: "ãƒ©ã‚¤ãƒ ãƒŸãƒ«ã‚¯", multiplier: 48, cost: 21600000000000000000000000000, color: "#33ff33", image: "export1750063812443.png" }
    ];

    // ã‚¯ãƒªãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰
    const clickUpgrades = [
      { power: 5, cost: 4000, image: "clickup_1.png" },
      { power: 4500, cost: 3500000, image: "clickup_2.png" },
      { power: 800000000, cost: 2500000000000, image: "clickup_3.png" },
      { power: 9000000000000000, cost: 1350000000000000000, image: "clickup_4.png" },
      { power: 1000000000000000000000, cost: 21500000000000000000000000, image: "clickup_5.png" },
      { power: 10000000000000000000000000000, cost: 21500000000000000000000000000, image: "clickup_6.png" }
    ];

    // æ–½è¨­ãƒ‡ãƒ¼ã‚¿
    const facilities = [
      { name: "ãƒˆã‚¤ãƒ¬ãƒƒãƒˆãƒšãƒ¼ãƒ‘ãƒ¼å·¥å ´", baseCost: 15, basePower: 0.1, count: 0, image: "toilet_paper_factory.png" },
      { name: "æ±šã‚ŒãŸé´å±‹", baseCost: 100, basePower: 1, count: 0, image: "dirty_shoe_shop.png" },
      { name: "ä¸‹ç—¢è£½é€ æ©Ÿ", baseCost: 1100, basePower: 8, count: 0, image: "diarrhea_machine.png" },
      { name: "ãƒˆã‚¤ãƒ¬ç¥æ®¿", baseCost: 12000, basePower: 47, count: 0, image: "toilet_temple.png" },
      { name: "ãã•ã„ç‰§å ´", baseCost: 130000, basePower: 260, count: 0, image: "stinky_ranch.png" },
      { name: "ã†â—‹ã“è¡›æ˜Ÿ", baseCost: 1400000, basePower: 1400, count: 0, image: "poop_satellite.png" },
      { name: "æ’æ³„å·¥å ´", baseCost: 20000000, basePower: 7800, count: 0, image: "excretion_factory.png" },
      { name: "ä¾¿ç§˜AI", baseCost: 300000000, basePower: 44000, count: 0, image: "constipation_ai.png" },
      { name: "ãƒŸã‚¹ãƒ†ãƒªãƒ¼ãƒˆã‚¤ãƒ¬", baseCost: 5000000000, basePower: 260000, count: 0, image: "mystery_toilet.png" },
      { name: "ã†â—‹ã“ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«", baseCost: 80000000000, basePower: 1600000, count: 0, image: "poop_blackhole.png" },
      { name: "ã†â—‹ã“ã®é­”æ³•å¡”", baseCost: 960000000000, basePower: 57600000, count: 0, image: "poop_magic_tower.png" },
      { name: "ã†â—‹ã“è²¨ç‰©èˆ¹", baseCost: 36600000000000, basePower: 887600000, count: 0, image: "poop_cargo_ship.png" },
      { name: "ã†â—‹ã“ã‚¿ã‚¤ãƒ ãƒã‚·ãƒ³", baseCost: 7560000000000000, basePower: 9997600000, count: 0, image: "poop_time_machine.png" },
      { name: "ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ã†â—‹ã“", baseCost: 91600000000000000, basePower: 84557600000, count: 0, image: "rainbow_poop.png" },
      { name: "ãƒ—ãƒªã‚ºãƒ ã†â—‹ã“", baseCost: 11160000000000000000, basePower: 1284557624000, count: 0, image: "prism_poop.png" },
      { name: "ãƒ™ãƒ¬ãƒ¼ãƒŠãƒ«ã†â—‹ã“", baseCost: 1300000000000000000000, basePower: 14484257630000, count: 0, image: "berenal_poop.png" },
      { name: "ãƒ•ãƒ©ã‚¯ã‚¿ãƒ«ã†â—‹ã“", baseCost: 32230000000000000000000000, basePower: 192544387690000, count: 0, image: "fractal_poop.png" }
    ];

    // HTMLè¦ç´ å–å¾—
    const poopEl = document.getElementById("poop");
    const shopEl = document.getElementById("shop");
    const upgradesEl = document.getElementById("upgrades");
    const clickUpgradesEl = document.getElementById("clickUpgrades");
    const poopImage = document.getElementById("poopImage");
    const clickSE = document.getElementById("clickSE");
    const feverSE = document.getElementById("feverSE");
    const rebirthCountEl = document.getElementById("rebirthCount");
    const rebirthBonusEl = document.getElementById("rebirthBonus");
    const rebirthBtn = document.getElementById("rebirthBtn");

    // æ•°å­—ã‚’å˜ä½ä»˜ãã«å¤‰æ›ã™ã‚‹é–¢æ•°ï¼ˆä¾‹ï¼š1,500 â†’ 1.5Kï¼‰
    function formatNumber(n) {
      if (n < 1000) return n.toFixed(0);
      const tier = Math.floor(Math.log10(n) / 3);
      if (tier === 0) return n.toFixed(0);
      const unit = units[tier] || ("e" + (tier*3));
      const scale = Math.pow(10, tier * 3);
      const scaled = n / scale;
      return scaled.toFixed(2) + unit;
    }

    // Poopç”»åƒã‚¯ãƒªãƒƒã‚¯æ™‚å‡¦ç†
    poopImage.onclick = () => {
      if (!feverMode && Math.random() < 0.0016) {
        activateFever();
      }
      poop += clickPower * milkData[milkLevel].multiplier * rebirthMultiplier * (feverMode ? 7 : 1);
      clickSE.currentTime = 0;
      clickSE.play();
      updateDisplay();
    };

    // ãƒ•ã‚£ãƒ¼ãƒãƒ¼ãƒ¢ãƒ¼ãƒ‰é–‹å§‹
    function activateFever() {
      feverMode = true;
      feverSE.play();
      document.body.classList.add("fever");
      clearTimeout(feverTimeout);
      feverTimeout = setTimeout(() => {
        feverMode = false;
        document.body.classList.remove("fever");
      }, 5 * 60 * 1000); // 5åˆ†é–“
    }

    // æ–½è¨­è³¼å…¥å‡¦ç†
    function buyFacility(index) {
      const f = facilities[index];
      const cost = Math.floor(f.baseCost * Math.pow(1.15, f.count));
      if (poop >= cost) {
        poop -= cost;
        f.count++;
        updateDisplay();
      }
    }

    // ãƒŸãƒ«ã‚¯è³¼å…¥å‡¦ç†
    function buyMilk(level) {
      const data = milkData[level];
      if (milkLevel === level - 1 && poop >= data.cost) {
        poop -= data.cost;
        milkLevel = level;
        updateDisplay();
      }
    }

    // ã‚¯ãƒªãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰è³¼å…¥
    function buyClickUpgrade() {
      const u = clickUpgrades[clickUpgradeLevel];
      if (u && poop >= u.cost) {
        poop -= u.cost;
        clickPower = u.power * rebirthMultiplier;
        clickUpgradeLevel++;
        updateDisplay();
      }
    }

    // è»¢ç”Ÿå‡¦ç†
    function rebirth() {
      const requiredPoop = 1e12;
      if (poop < requiredPoop) {
        alert(`è»¢ç”Ÿã™ã‚‹ã«ã¯å°‘ãªãã¨ã‚‚${formatNumber(requiredPoop)} Poopå¿…è¦ã§ã™ã€‚`);
        return;
      }
      if (!confirm("æœ¬å½“ã«è»¢ç”Ÿã—ã¾ã™ã‹ï¼Ÿ\nè»¢ç”Ÿã™ã‚‹ã¨Poopã¨æ–½è¨­ã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã¯ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ãŒã€æ°¸ä¹…ãƒœãƒ¼ãƒŠã‚¹ãŒä»˜ãã¾ã™ã€‚")) {
        return;
      }
      rebirthCount++;
      rebirthMultiplier = 1 + rebirthCount * 0.15;
      poop = 0;
      milkLevel = 0;
      clickPower = 1 * rebirthMultiplier;
      clickUpgradeLevel = 0;
      facilities.forEach(f => f.count = 0);
      updateDisplay();
      alert(`è»¢ç”Ÿå®Œäº†ï¼ãƒœãƒ¼ãƒŠã‚¹å€ç‡ãŒ${rebirthMultiplier.toFixed(2)}å€ã«ãªã‚Šã¾ã—ãŸã€‚`);
    }

    // ãƒªã‚»ãƒƒãƒˆå‡¦ç†
    function resetGame() {
      if (!confirm("ã‚²ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\né€²è¡ŒçŠ¶æ³ã¯å¤±ã‚ã‚Œã¾ã™ã€‚")) return;
      poop = 0;
      clickPower = 1;
      milkLevel = 0;
      clickUpgradeLevel = 0;
      facilities.forEach(f => f.count = 0);
      rebirthCount = 0;
      rebirthMultiplier = 1;
      feverMode = false;
      document.body.classList.remove("fever");
      clearTimeout(feverTimeout);
      updateDisplay();
    }

    // ç”»é¢æ›´æ–°
    function updateDisplay() {
      poopEl.textContent = formatNumber(poop);
      document.body.style.backgroundColor = milkData[milkLevel].color;
      poopImage.src = milkData[milkLevel].image;

      // æ–½è¨­ãƒªã‚¹ãƒˆæ›´æ–°
      shopEl.innerHTML = "";
      facilities.forEach((f, i) => {
        const cost = Math.floor(f.baseCost * Math.pow(1.15, f.count));
        const div = document.createElement("div");
        div.className = "shop-item";
        div.innerHTML = `
          <img src="${f.image}" alt="${f.name}" />
          <div>
            <strong>${f.name}</strong> ï¼ˆ${f.count}å°ï¼‰<br />
            ç”Ÿç”£: ${formatNumber(f.basePower * f.count * rebirthMultiplier)} / ç§’<br />
            ä¾¡æ ¼: ${formatNumber(cost)} Poop
          </div>
          <button onclick="buyFacility(${i})" ${poop < cost ? "disabled" : ""}>è³¼å…¥</button>
        `;
        shopEl.appendChild(div);
      });

      // ãƒŸãƒ«ã‚¯ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ›´æ–°ï¼ˆ4ã¤ã ã‘è¡¨ç¤ºï¼‰
      upgradesEl.innerHTML = "";
      for (let i = 1; i <= 7; i++) {
        const data = milkData[i];
        const bought = milkLevel >= i;
        const div = document.createElement("div");
        div.className = "upgrade-item";
        div.innerHTML = `
          <img src="${data.image}" alt="${data.name}" />
          <div>
            <strong>${data.name}</strong><br />
            å€ç‡: x${data.multiplier}<br />
            ä¾¡æ ¼: ${formatNumber(data.cost)} Poop
          </div>
          <button onclick="buyMilk(${i})" ${bought || poop < data.cost ? "disabled" : ""}>è³¼å…¥</button>
        `;
        upgradesEl.appendChild(div);
      }

      // ã‚¯ãƒªãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ›´æ–°
      clickUpgradesEl.innerHTML = "";
      const cu = clickUpgrades[clickUpgradeLevel];
      if (cu) {
        const div = document.createElement("div");
        div.className = "click-upgrade-item";
        div.innerHTML = `
          <img src="${cu.image}" alt="ã‚¯ãƒªãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰" />
          <div>
            <strong>ã‚¯ãƒªãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ Lv.${clickUpgradeLevel + 1}</strong><br />
            ã‚¯ãƒªãƒƒã‚¯åŠ›: x${cu.power}<br />
            ä¾¡æ ¼: ${formatNumber(cu.cost)} Poop
          </div>
          <button onclick="buyClickUpgrade()" ${poop < cu.cost ? "disabled" : ""}>è³¼å…¥</button>
        `;
        clickUpgradesEl.appendChild(div);
      } else {
        clickUpgradesEl.innerHTML = "<p>ã™ã¹ã¦ã®ã‚¯ãƒªãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚’è³¼å…¥æ¸ˆã¿ã§ã™ã€‚</p>";
      }

      // è»¢ç”Ÿæƒ…å ±æ›´æ–°
      rebirthCountEl.textContent = rebirthCount;
      rebirthBonusEl.textContent = `x${rebirthMultiplier.toFixed(2)}`;

      // è»¢ç”Ÿãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹åˆ¶å¾¡
      rebirthBtn.disabled = poop < 1e12;
    }

    // è‡ªå‹•ç”Ÿç”£å‡¦ç†ï¼ˆ1ç§’ã”ã¨ï¼‰
    setInterval(() => {
      let production = 0;
      facilities.forEach(f => {
        production += f.basePower * f.count;
      });
      production *= rebirthMultiplier;
      if (feverMode) production *= 7;
      poop += production;
      updateDisplay();
    }, 1000);

    // åˆæœŸè¡¨ç¤ºæ›´æ–°
    updateDisplay();
  </script>
</body>
</html>
