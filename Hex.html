<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>æ°·å‰²ã‚Šãƒãƒˆãƒ« ğŸ§Š</title>
  <style>
    body { font-family: sans-serif; background: #eef; text-align: center; }
    .grid {
      display: flex;
      flex-wrap: wrap;
      width: 520px;
      margin: 20px auto;
    }
    .hex {
      width: 60px;
      height: 52px;
      background: skyblue;
      clip-path: polygon(
        50% 0%, 100% 25%, 100% 75%,
        50% 100%, 0% 75%, 0% 25%
      );
      margin: 2px;
      position: relative;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .hex.red { background: #ff6b6b; }
    .hex.broken { background: #bbb; pointer-events: none; }

    .stick {
      width: 6px;
      height: 40px;
      background: #555;
      position: absolute;
      top: -45px;
      left: 27px;
      transform-origin: bottom center;
      animation: hit 0.2s ease-in-out 5;
    }
    @keyframes hit {
      0% { transform: rotate(0deg); }
      50% { transform: rotate(-30deg); }
      100% { transform: rotate(0deg); }
    }

    #status, #turnInfo, #playerAction {
      margin: 10px;
      font-size: 18px;
    }

    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10;
      color: white;
      font-size: 24px;
      display: none;
      flex-direction: column;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      margin: 10px;
    }
  </style>
</head>
<body>
  <h1>æ°·å‰²ã‚Šãƒãƒˆãƒ« ğŸ§Š</h1>
  <p id="turnInfo">ç¾åœ¨ã®ã‚¿ãƒ¼ãƒ³: Player 1</p>
  <button onclick="spinRoulette()">ğŸ² è‡ªåˆ†ã ã‘ãŒæŠ¼ã™: ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ</button>
  <p id="playerAction">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: æœªé¸æŠ</p>
  <div class="grid" id="grid"></div>
  <p id="status">ã‚²ãƒ¼ãƒ é–‹å§‹ï¼</p>

  <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºï¼ˆè¡Œå‹•ç¢ºèªï¼‰ -->
  <div class="modal" id="modal">
    <div id="modalText">è¡Œå‹•: é€šå¸¸å©ã</div>
    <button onclick="confirmAction()">OKï¼ˆç›¸æ‰‹ã«è¦‹ã›ãªã„ï¼‰</button>
  </div>

  <script>
    const grid = document.getElementById("grid");
    const playerAction = document.getElementById("playerAction");
    const turnInfo = document.getElementById("turnInfo");
    const status = document.getElementById("status");
    const modal = document.getElementById("modal");
    const modalText = document.getElementById("modalText");

    const actions = [
      "é€šå¸¸å©ã",
      "å¼·ãå©ãï¼ˆå‘¨å›²ç¢ºç‡UPï¼‰",
      "ã‚¹ã‚­ãƒ£ãƒ³ï¼ˆè¦‹ã‹ã‘ã ã‘ï¼‰",
      "ç§»å‹•ï¼ˆåŠ¹æœãªã—ï¼‰",
      "è‰²äº¤æ›ï¼ˆåŠ¹æœãªã—ï¼‰",
      "è‡ªæ°·é˜²å¾¡UPï¼ˆåŠ¹æœãªã—ï¼‰",
      "æ•µæ°·å‡çµï¼ˆåŠ¹æœãªã—ï¼‰",
      "ãƒã‚ºãƒ¬ï¼ˆè¡Œå‹•ãªã—ï¼‰"
    ];

    let blocks = [];
    let currentPlayer = 1;
    let currentAction = null;
    let gameEnded = false;

    function init() {
      const colors = Array(25).fill("red").concat(Array(25).fill("blue"));
      colors.sort(() => Math.random() - 0.5);
      for (let i = 0; i < 50; i++) {
        const div = document.createElement("div");
        div.className = "hex " + (colors[i] === "red" ? "red" : "");
        div.dataset.index = i;
        div.onclick = () => onClickBlock(i);
        grid.appendChild(div);
        blocks.push({
          element: div,
          broken: false,
          color: colors[i]
        });
      }
    }

    function spinRoulette() {
      if (gameEnded) return;
      const i = Math.floor(Math.random() * actions.length);
      currentAction = actions[i];
      modalText.textContent = `ğŸ² è¡Œå‹•: ${currentAction}`;
      modal.style.display = "flex";
    }

    function confirmAction() {
      modal.style.display = "none";
      playerAction.textContent = `ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: ${currentAction}`;
    }

    function onClickBlock(index) {
      if (!currentAction || gameEnded) return;
      const block = blocks[index];
      if (block.broken) return;

      if (currentAction === "ãƒã‚ºãƒ¬ï¼ˆè¡Œå‹•ãªã—ï¼‰") {
        endTurn("ãƒã‚ºãƒ¬ï¼");
        return;
      }

      // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ£’
      const stick = document.createElement("div");
      stick.className = "stick";
      block.element.appendChild(stick);

      setTimeout(() => {
        block.element.removeChild(stick);
        if (currentAction.includes("å©ã")) {
          tryBreakBlock(index);
        }
        endTurn("æ¬¡ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¸");
      }, 1200);
    }

    function tryBreakBlock(index) {
      const block = blocks[index];
      if (block.broken) return;

      const chance = currentAction.includes("å¼·ã") ? 0.6 : 0.3;
      if (Math.random() < chance) {
        block.broken = true;
        block.element.classList.add("broken");
        checkWin();
        return;
      }

      const neighbors = getNeighbors(index);
      const randNeighbor = neighbors[Math.floor(Math.random() * neighbors.length)];
      if (randNeighbor && !blocks[randNeighbor].broken && Math.random() < 0.2) {
        blocks[randNeighbor].broken = true;
        blocks[randNeighbor].element.classList.add("broken");
        checkWin();
      }
    }

    function getNeighbors(index) {
      const res = [];
      if (index > 0) res.push(index - 1);
      if (index < 49) res.push(index + 1);
      if (index - 10 >= 0) res.push(index - 10);
      if (index + 10 < 50) res.push(index + 10);
      return res;
    }

    function endTurn(message) {
      currentAction = null;
      currentPlayer = currentPlayer === 1 ? 2 : 1;
      turnInfo.textContent = `ç¾åœ¨ã®ã‚¿ãƒ¼ãƒ³: Player ${currentPlayer}`;
      playerAction.textContent = "ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: æœªé¸æŠ";
      status.textContent = message;
    }

    function checkWin() {
      if (blocks.every(b => b.broken)) {
        status.textContent = `ğŸ‰ Player ${currentPlayer} ã®å‹åˆ©ï¼ ğŸ‰`;
        gameEnded = true;
      }
    }

    init();
  </script>
</body>
</html>
