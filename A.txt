<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Poopã‚¯ãƒªãƒƒã‚«ãƒ¼ with è»¢ç”Ÿãƒœãƒ¼ãƒŠã‚¹ï¼†å˜ä½è¡¨è¨˜</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f9e7c7;
      color: #3e2f1c;
      text-align: center;
      transition: background 0.5s;
    }
    #poopImage {
      width: 220px;
      cursor: pointer;
      margin: 20px;
      border-radius: 50%;
      box-shadow: 0 0 20px rgba(80,60,30,0.3);
    }
    .section {
      max-width: 600px;
      margin: auto;
    }
    .shop-item, .upgrade-item, .click-upgrade-item {
      margin: 10px;
      padding: 10px;
      background: #fffbe0;
      border: 1px solid #99845f;
      border-radius: 8px;
      display: flex;
      align-items: center;
    }
    .shop-item img, .upgrade-item img, .click-upgrade-item img {
      width: 64px;
      height: 64px;
      margin-right: 10px;
      border-radius: 8px;
      object-fit: cover;
      border: 1px solid #a07f3e;
    }
    button {
      margin-top: 5px;
    }
    .fever {
      animation: feverFlash 0.5s infinite alternate;
    }
    @keyframes feverFlash {
      from { background-color: #ffcc00; }
      to { background-color: #ffe066; }
    }
    #rebirthSection {
      margin-top: 30px;
      background: #fffbe0;
      border: 2px solid #99845f;
      padding: 10px;
      border-radius: 8px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
  </style>
</head>
<body>
  <h1>ğŸ’© Poop ã‚¯ãƒªãƒƒã‚«ãƒ¼ ğŸ’©</h1>
  <p>Poop: <span id="poop">0</span></p>
  <img id="poopImage" src="export1750063812443.png" alt="Poop" />
  <p><button onclick="resetGame()">ğŸ” ãƒªã‚»ãƒƒãƒˆ</button></p>

  <div class="section">
    <h2>æ–½è¨­ã‚·ãƒ§ãƒƒãƒ—</h2>
    <div id="shop"></div>
  </div>

  <div class="section">
    <h2>ãƒŸãƒ«ã‚¯ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰</h2>
    <div id="upgrades"></div>
  </div>

  <div class="section">
    <h2>ã‚¯ãƒªãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰</h2>
    <div id="clickUpgrades"></div>
  </div>

  <!-- è»¢ç”Ÿãƒœãƒ¼ãƒŠã‚¹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <div id="rebirthSection">
    <h2>è»¢ç”Ÿãƒœãƒ¼ãƒŠã‚¹</h2>
    <p>è»¢ç”Ÿå›æ•°: <span id="rebirthCount">0</span></p>
    <p>è»¢ç”Ÿå€ç‡: <span id="rebirthMultiplier">1</span> å€</p>
    <button onclick="rebirth()">ğŸ”„ è»¢ç”Ÿã™ã‚‹ï¼ˆPoopãŒ100ä¸‡ä»¥ä¸Šã§å¯èƒ½ï¼‰</button>
    <p><small>è»¢ç”Ÿã™ã‚‹ã¨Poopã¯ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ãŒã€æ°¸ä¹…ã«ã‚¯ãƒªãƒƒã‚¯åŠ›ã¨æ–½è¨­ã®ç”Ÿç”£åŠ›ãŒä¸Šæ˜‡ã—ã¾ã™ã€‚</small></p>
  </div>

  <audio id="clickSE" src="https://cdn.pixabay.com/audio/2022/03/15/audio_676d8b6c4f.mp3" preload="auto"></audio>
  <audio id="feverSE" src="https://cdn.pixabay.com/audio/2022/03/04/audio_9cf69cc69e.mp3" preload="auto"></audio>

<script>
  // ---------- åŸºæœ¬ã‚¹ãƒ†ãƒ¼ãƒˆ ----------
  let poop = 0;
  let clickPower = 1;
  let milkLevel = 0;
  let clickUpgradeLevel = 0;
  let feverMode = false;
  let feverTimeout;
  let rebirthCount = 0;
  let rebirthMultiplier = 1;

  // ---------- å˜ä½è¡¨è¨˜ãƒªã‚¹ãƒˆ (ç„¡é™ã«æ‹¡å¼µå¯èƒ½) ----------
  const units = [
    "", "K", "M", "B", "T",
    "Qa", "Qi", "Sx", "Sp", "Oc",
    "No", "De", "Ud", "Dd", "Td",
    "Qa2", "Qi2", "Sx2", "Sp2", "Oc2",
    // å¿…è¦ãªã‚‰ã©ã‚“ã©ã‚“ç¶šã‘ã¦ãã ã•ã„
  ];

  function formatNumber(num) {
    if (num < 1000) return Math.floor(num).toString();
    let tier = Math.floor(Math.log10(num) / 3);
    if (tier >= units.length) tier = units.length -1;
    let scale = Math.pow(10, tier * 3);
    let scaled = num / scale;
    return scaled.toFixed(2) + units[tier];
  }

  // ---------- ãƒŸãƒ«ã‚¯ãƒ‡ãƒ¼ã‚¿ ----------
  const milkData = [
    { name: "ãªã—", multiplier: 1, cost: 0, color: "#f9e7c7", image: "export1750063812443.png" },
    { name: "ä½è„‚è‚ªãƒŸãƒ«ã‚¯", multiplier: 1.5, cost: 1000, color: "#e1f0e5", image: "export1750063812443.png" },
    { name: "æ™®é€šãƒŸãƒ«ã‚¯", multiplier: 3, cost: 7e6, color: "#d9f1ff", image: "export1750063812443.png" },
    { name: "æ¿ƒåšãƒŸãƒ«ã‚¯", multiplier: 6, cost: 140e12, color: "#fff5d6", image: "export1750063812443.png" },
    { name: "é‡‘ã®ãƒŸãƒ«ã‚¯", multiplier: 10, cost: 136e15, color: "#fff8b2", image: "milk4.png" }
  ];

  // ---------- ã‚¯ãƒªãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ ----------
  const clickUpgrades = [
    { power: 5, cost: 4000, image: "click1.png" },
    { power: 4500, cost: 3.5e6, image: "click2.png" },
    { power: 80e7, cost: 25e10, image: "click3.png" },
    { power: 90e15, cost: 135e16, image: "click4.png" },
    { power: 10e18, cost: 21.5e21, image: "click5.png" }
  ];

  // ---------- æ–½è¨­ãƒ‡ãƒ¼ã‚¿ ----------
  const facilities = [
    { name: "ãƒˆã‚¤ãƒ¬ãƒƒãƒˆãƒšãƒ¼ãƒ‘ãƒ¼å·¥å ´", baseCost: 15, basePower: 0.1, count: 0, image: "factory.png" },
    { name: "æ±šã‚ŒãŸé´å±‹", baseCost: 100, basePower: 1, count: 0, image: "shoe.png" },
    { name: "ä¸‹ç—¢è£½é€ æ©Ÿ", baseCost: 1100, basePower: 8, count: 0, image: "machine.png" },
    { name: "ãƒˆã‚¤ãƒ¬ç¥æ®¿", baseCost: 12000, basePower: 47, count: 0, image: "temple.png" }
    // çœç•¥ã›ãšè¿½åŠ ã—ã¦ãã ã•ã„
  ];

  // ---------- DOMè¦ç´  ----------
  const poopEl = document.getElementById("poop");
  const shopEl = document.getElementById("shop");
  const upgradesEl = document.getElementById("upgrades");
  const clickUpgradesEl = document.getElementById("clickUpgrades");
  const poopImage = document.getElementById("poopImage");
  const clickSE = document.getElementById("clickSE");
  const feverSE = document.getElementById("feverSE");
  const rebirthCountEl = document.getElementById("rebirthCount");
  const rebirthMultiplierEl = document.getElementById("rebirthMultiplier");

  // ---------- ã‚¯ãƒªãƒƒã‚¯å‡¦ç† ----------
  poopImage.onclick = () => {
    if (!feverMode && Math.random() < 0.0016) {
      activateFever();
    }
    poop += clickPower * milkData[milkLevel].multiplier * rebirthMultiplier * (feverMode ? 7 : 1);
    clickSE.currentTime = 0;
    clickSE.play();
    updateDisplay();
  };

  // ---------- ãƒ•ã‚£ãƒ¼ãƒãƒ¼ãƒ¢ãƒ¼ãƒ‰ ----------
  function activateFever() {
    feverMode = true;
    feverSE.play();
    document.body.classList.add("fever");
    clearTimeout(feverTimeout);
    feverTimeout = setTimeout(() => {
      feverMode = false;
      document.body.classList.remove("fever");
      updateDisplay();
    }, 5 * 60 * 1000);
  }

  // ---------- æ–½è¨­è³¼å…¥ ----------
  function buyFacility(index) {
    const f = facilities[index];
    const cost = Math.floor(f.baseCost * Math.pow(1.15, f.count));
    if (poop >= cost) {
      poop -= cost;
      f.count++;
      updateDisplay();
    }
  }

  // ---------- ãƒŸãƒ«ã‚¯è³¼å…¥ ----------
  function buyMilk(level) {
    const data = milkData[level];
    if (milkLevel === level - 1 && poop >= data.cost) {
      poop -= data.cost;
      milkLevel = level;
      updateDisplay();
    }
  }

  // ---------- ã‚¯ãƒªãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰è³¼å…¥ ----------
  function buyClickUpgrade() {
    const u = clickUpgrades[clickUpgradeLevel];
    if (u && poop >= u.cost) {
      poop -= u.cost;
      clickPower = u.power;
      clickUpgradeLevel++;
      updateDisplay();
    }
  }

  // ---------- è»¢ç”Ÿå‡¦ç† ----------
  function rebirth() {
    if (poop < 1e6) {
      alert("PoopãŒ100ä¸‡ä»¥ä¸Šå¿…è¦ã§ã™ï¼");
      return;
    }
    if (!confirm("è»¢ç”Ÿã™ã‚‹ã¨PoopãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã€æ°¸ä¹…ã«ç”Ÿç”£åŠ›ãŒä¸Šæ˜‡ã—ã¾ã™ã€‚æœ¬å½“ã«è»¢ç”Ÿã—ã¾ã™ã‹ï¼Ÿ")) return;

    rebirthCount++;
    rebirthMultiplier = 1 + rebirthCount * 0.2; // è»¢ç”Ÿã”ã¨ã«20%ä¸Šæ˜‡
    poop = 0;
    milkLevel = 0;
    clickPower = 1;
    clickUpgradeLevel = 0;
    facilities.forEach(f => f.count = 0);

    updateDisplay();
  }

  // ---------- è¡¨ç¤ºæ›´æ–° ----------
  function updateDisplay() {
    poopEl.textContent = formatNumber(poop);
    document.body.style.backgroundColor = milkData[milkLevel].color;
    poopImage.src = milkData[milkLevel].image;

    rebirthCountEl.textContent = rebirthCount;
    rebirthMultiplierEl.textContent = rebirthMultiplier.toFixed(2);

    shopEl.innerHTML = "";
    facilities.forEach((f, i) => {
      const cost = Math.floor(f.baseCost * Math.pow(1.15, f.count));
      const el = document.createElement("div");
      el.className = "shop-item";
      el.innerHTML = `
        <img src="${f.image}" alt="${f.name}" />
        <div>
          <strong>${f.name}ï¼ˆ${f.count}ï¼‰</strong><br>
          ç”Ÿç”£: ${formatNumber(f.basePower)}/ç§’<br>
          ä¾¡æ ¼: ${formatNumber(cost)} Poop<br>
          <button onclick="buyFacility(${i})">è³¼å…¥</button>
        </div>`;
      shopEl.appendChild(el);
    });

    upgradesEl.innerHTML = "";
    for (let i = 1; i < milkData.length; i++) {
      const data = milkData[i];
      const bought = milkLevel >= i;
      const el = document.createElement("div");
      el.className = "upgrade-item";
      el.innerHTML = `
        <img src="${data.image}" alt="${data.name}" />
        <div>
          <strong>${data.name}ï¼ˆå€ç‡Ã—${data.multiplier}ï¼‰</strong><br>
          <button ${bought ? "disabled" : ""} onclick="buyMilk(${i})">
            ${bought ? "è³¼å…¥æ¸ˆã¿" : formatNumber(data.cost) + " Poopã§è³¼å…¥"}
          </button>
        </div>`;
      upgradesEl.appendChild(el);
    }

    clickUpgradesEl.innerHTML = "";
    const cu = clickUpgrades[clickUpgradeLevel];
    if (cu) {
      const el = document.createElement("div");
      el.className = "click-upgrade-item";
      el.innerHTML = `
        <img src="${cu.image}" alt="ã‚¯ãƒªãƒƒã‚¯å¼·åŒ–" />
        <div>
          ã‚¯ãƒªãƒƒã‚¯å¼·åŒ–ï¼ˆâ†’${formatNumber(cu.power)}ï¼‰<br>
          <button onclick="buyClickUpgrade()">${formatNumber(cu.cost)} Poopã§è³¼å…¥</button>
        </div>`;
      clickUpgradesEl.appendChild(el);
    }

    saveGame();
  }

  // ---------- è‡ªå‹•ç”Ÿç”£å‡¦ç† ----------
  function producePoop() {
    let gain = 0;
    facilities.forEach(f => {
      gain += f.basePower * f.count;
    });
    gain *= milkData[milkLevel].multiplier * rebirthMultiplier * (feverMode ? 7 : 1) / 10;
    poop += gain;
    updateDisplay();
  }

  // ---------- ã‚»ãƒ¼ãƒ– ----------
  function saveGame() {
    const saveData = {
      poop,
      milkLevel,
      clickPower,
      clickUpgradeLevel,
      facilities: facilities.map(f => f.count),
      lastTime: Date.now(),
      rebirthCount,
      rebirthMultiplier
    };
    localStorage.setItem("poopClickerSave", JSON.stringify(saveData));
  }

  // ---------- ãƒ­ãƒ¼ãƒ‰ ----------
  function loadGame() {
    const data = localStorage.getItem("poopClickerSave");
    if (!data) return;
    const save = JSON.parse(data);
    poop = save.poop || 0;
    milkLevel = save.milkLevel || 0;
    clickPower = save.clickPower || 1;
    clickUpgradeLevel = save.clickUpgradeLevel || 0;
    save.facilities?.forEach((count, i) => {
      if (facilities[i]) facilities[i].count = count;
    });
    rebirthCount = save.rebirthCount || 0;
    rebirthMultiplier = save.rebirthMultiplier || 1;

    const lastTime = save.lastTime || Date.now();
    const diff = Math.floor((Date.now() - lastTime) / 1000);
    const offlineGain = diff * facilities.reduce((sum, f) => sum + f.basePower * f.count, 0) * milkData[milkLevel].multiplier * rebirthMultiplier;
    if (offlineGain > 0) {
      alert(`ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å ±é…¬: ${formatNumber(offlineGain)} Poop ç²å¾—ã—ã¾ã—ãŸï¼`);
      poop += offlineGain;
    }
  }

  // ---------- ãƒªã‚»ãƒƒãƒˆ ----------
  function resetGame() {
    if (confirm("æœ¬å½“ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")) {
      poop = 0;
      milkLevel = 0;
      clickPower = 1;
      clickUpgradeLevel = 0;
      facilities.forEach(f => f.count = 0);
      rebirthCount = 0;
      rebirthMultiplier = 1;
      localStorage.removeItem("poopClickerSave");
      updateDisplay();
    }
  }

  loadGame();
  updateDisplay();
  setInterval(producePoop, 100);

</script>
</body>
</html>
